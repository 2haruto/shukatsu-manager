{% extends "base.html" %}

{% block title %}{{ company.name }} | 就活管理アプリ{% endblock %}

{% block content %}
<div class="card">
  <h2 class="page-title">{{ company.name }}</h2>

  <div class="actions">
    <a href="{% url 'company_list' %}" class="button button-secondary">一覧へ</a>
    <a href="{% url 'company_update' company.id %}" class="button">企業編集</a>
    <a href="{% url 'company_delete' company.id %}" class="button button-secondary">削除</a>
    <a href="{% url 'interview_create' %}" class="button">面接追加</a>
  </div>

  <div class="detail-list">
    <div class="detail-label">ステータス</div>
    <div class="detail-value"><span class="badge">{{ company.get_status_display }}</span></div>

    <div class="detail-label">職種</div>
    <div class="detail-value">{{ company.role|default:"未設定" }}</div>

    <div class="detail-label">優先度</div>
    <div class="detail-value">{{ company.priority }}</div>

    {% if company.url %}
      <div class="detail-label">URL</div>
      <div class="detail-value">
        <a href="{{ company.url }}" target="_blank" rel="noopener noreferrer">{{ company.url }}</a>
      </div>
    {% endif %}

    {% if company.memo %}
      <div class="detail-label">メモ</div>
      <div class="detail-value">{{ company.memo|linebreaksbr }}</div>
    {% endif %}

    {% if company.resume_memo %}
      <div class="detail-label">コピペ用メモ</div>
      <div class="detail-value">
        <div class="copy-block">
          <button
            type="button"
            class="button button-secondary copy-button"
            data-copy-text="{{ company.resume_memo|escapejs }}"
          >
            コピー
          </button>
          <div class="copy-text">{{ company.resume_memo|linebreaksbr }}</div>
        </div>
      </div>
    {% endif %}

    {% if company.self_pr %}
      <div class="detail-label">自己PR</div>
      <div class="detail-value">
        <div class="copy-block">
          <button
            type="button"
            class="button button-secondary copy-button"
            data-copy-text="{{ company.self_pr|escapejs }}"
          >
            コピー
          </button>
          <div class="copy-text">{{ company.self_pr|linebreaksbr }}</div>
        </div>
      </div>
    {% endif %}

    {% if company.motivation %}
      <div class="detail-label">志望動機</div>
      <div class="detail-value">
        <div class="copy-block">
          <button
            type="button"
            class="button button-secondary copy-button"
            data-copy-text="{{ company.motivation|escapejs }}"
          >
            コピー
          </button>
          <div class="copy-text">{{ company.motivation|linebreaksbr }}</div>
        </div>
      </div>
    {% endif %}
  </div>
</div>

<div class="card">
  <h3 class="section-title">面接一覧</h3>

  {% if interviews %}
    <ul class="list">
      {% for i in interviews %}
        <li>
          {{ i.scheduled_at|date:"Y-m-d H:i" }}（{{ i.get_stage_display }}）
          <a href="{% url 'interview_detail' i.id %}">詳細</a>
        </li>
      {% endfor %}
    </ul>
  {% else %}
    <p class="empty-message">面接はまだありません。</p>
  {% endif %}
</div>

<script>
  document.addEventListener("DOMContentLoaded", () => {
    const buttons = document.querySelectorAll(".copy-button");

    buttons.forEach((button) => {
      button.addEventListener("click", async () => {
        const text = button.dataset.copyText || "";
        try {
          await navigator.clipboard.writeText(text);
          const original = button.textContent;
          button.textContent = "コピー済み";
          setTimeout(() => {
            button.textContent = original;
          }, 1200);
        } catch (error) {
          alert("コピーに失敗しました。手動でコピーしてください。");
        }
      });
    });
  });
</script>
{% endblock %}